**Change Request: CR‑108 – Automated Protocol Personalization & Adaptive SORK‑N Programs**

---

## 1. Objective

Extend CR‑107’s **Clinical Protocol Templates** so H3LIX can:

1. **Adapt protocols per participant** in a principled way (which modules to emphasize, when to advance, which tasks to repeat) using live data from:
   - symptoms/self‑report,  
   - Somatic & Symbolic streams,  
   - Noetic coherence C(t),  
   - MPG/RV/MUFS metrics.  [oai_citation:0‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
2. Keep **clinicians fully in charge**, with clear guardrails:
   - H3LIX proposes adaptations; clinicians approve/override.  
3. Use SORK‑N and MPG dynamics (“localize → roll up → restructure → project down”) as the backbone of adaptation, not opaque black‑box magic.  [oai_citation:1‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

This turns static protocol templates into **adaptive SORK‑N programs** that personalize *pace* and *emphasis* while remaining auditable and safe.

---

## 2. Scope

### In scope

- New data model for **protocol state**:
  - `:ProtocolInstance`, `:ModuleState`, `:StepState`.  
- A **Protocol Personalization Engine** that:
  - ingests outcome measures + MPG/RV + coherence data,  
  - decides whether to advance / repeat / branch modules & steps,  
  - outputs suggestions, not commands.  
- Integration with:
  - Meta‑policy layer (CR‑008) so adaptation policies get trust scores and versioning,  
  - KMP app (CR‑102/107) for updated task schedules,  
  - Clinician console (CR‑105/106/107) for review & override.

### Out of scope

- Changing the *content* of protocols automatically (no LLM rewriting of interventions).  
- Diagnosis or treatment selection; we only adapt **parameters of a clinician‑chosen protocol**.

---

## 3. Theoretical grounding

Personalization uses the same core ideas as the paper:

- **MPG dynamics**: time‑indexed hierarchy MPGₜ updated as new evidence arrives; updates follow “localize → roll up → optionally restructure → project down.”  [oai_citation:2‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
- **Rogue Variables & Potency**: segments and pathways with outsized explanatory power for prediction–observation gaps, Potency Index as “future impact” signal.  [oai_citation:3‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
- **Noetic coherence**: global alignment measures (correlation matrices, entropy change, coherence spectra) as markers of “good” system configurations that predict better decisions under constraints.  [oai_citation:4‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
- **SORK‑N**: N→S′ step adjusts thresholds, attention, cadence, and policies based on coherence and prediction error.  [oai_citation:5‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

CR‑108: apply these to **protocols**:

- track how each module/step affects symptoms, coherence, and RV Potency,  
- treat protocol modules as “high‑level levers” in SORK‑N,  
- learn which levers to pull more/less often for this person.

---

## 4. Data model: protocol instances & progress

Building on CR‑107:

### 4.1 Protocol instances

New label: `:ProtocolInstance` – a specific protocol run for a specific participant.

```text
(:ClinicalProtocol)  --TEMPLATE-->
(:ProtocolInstance)  <--ASSIGNED-- (:Participant)
```

Properties:

```text
id
protocol_id           // link to template
participant_id
start_date
status: "ACTIVE" | "PAUSED" | "COMPLETED"
current_module_id
progress_index        // 0..1 coarse completion
risk_tier             // inherits from protocol
```

### 4.2 Module & step state

For each instance/module:

```text
(:ProtocolInstance)-[:HAS_MODULE_STATE]->(:ModuleState)
(:ProtocolModule)-[:TEMPLATE_FOR]->(:ModuleState)
```

`ModuleState` properties:

```text
id
module_id
status: "NOT_STARTED" | "IN_PROGRESS" | "COMPLETED" | "SKIPPED"
sessions_completed
steps_completed
personalized_weight   // emphasis 0..2 (1 = template default)
coherence_delta_mean  // avg change in C(t) when this module active
symptom_delta_mean
rv_potency_delta_mean // change in Potency of target segments
last_review_time
```

`StepState` (per ProtocolStep):

```text
(:ModuleState)-[:HAS_STEP_STATE]->(:StepState)
(:ProtocolStep)-[:TEMPLATE_FOR]->(:StepState)
```

Properties:

```text
id
step_id
status: "NOT_ASSIGNED" | "ASSIGNED" | "IN_PROGRESS" | "COMPLETED" | "SKIPPED"
assignments_count
completed_count
last_outcome_score     // result of last execution (0..1 composite)
coherence_effect       // ΔC averaged for this step
rv_effect              // ΔPotency on targeted segments
user_burden_score      // e.g. self-reported burden 0..1
```

These state nodes are the protocol‑level analogue of `:SegmentState` in MPGₜ.  [oai_citation:6‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 5. Adaptation targets (what can change)

We **do not** invent new interventions; we adjust:

1. **Pacing / advancement**  
   - When to move from Module A → B.  
   - When to repeat a module before moving on.

2. **Emphasis / weighting**  
   - Increase/decrease frequency of certain step types (e.g., exposure vs journaling).

3. **Dosage**  
   - Short vs longer homework tasks.  
   - Number of repetitions per week.

4. **Scheduling**  
   - What tasks appear in the KMP app in the next block (day/week).

5. **Branching within template**  
   - Some modules marked as **optional** or **branchable**; engine can choose which optional branch first, under clinician oversight.

Everything is controlled through **ModuleState.personalized_weight** and StepState stats, plus scheduling decisions from the adaptation engine.

---

## 6. Personalization signals (what we learn from)

For each ProtocolInstance, the engine continuously aggregates:

1. **Outcome measures** (from CR‑107):
   - Symptom scales, functional measures, adherence.  
2. **Somatic signals**:
   - HRV, arousal during relevant tasks or episodes, change over time.  [oai_citation:7‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
3. **Noetic coherence**:
   - coherence C(t) during module‑related tasks vs baseline.  [oai_citation:8‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
4. **MPG / RV metrics**:
   - Imp/Conf of target segments,  
   - Potency of relevant RVs and their change across sessions.  [oai_citation:9‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
5. **MPG‑Intuition metrics**:
   - performance of MPG‑Intuitive decisions vs non‑intuitive under restricted awareness (where applicable).  [oai_citation:10‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
6. **Client & clinician ratings**:
   - perceived helpfulness of modules/steps,  
   - burden/fatigue.

All of these feed into a **ModuleScore** and **StepScore** used by the adaptation logic.

---

## 7. Personalization engine: logic & algorithms

We introduce a **Protocol Personalization Engine (PPE)** that operates at the end of each “block” (e.g., after each session or week).

### 7.1 ModuleScore & StepScore

For every ModuleState M:

```text
ModuleScore(M) = w_sym * Δsymptom_norm
                + w_func * Δfunction_norm
                + w_coh  * Δcoherence_norm
                + w_rv   * (-ΔPotency_norm)  // Potency reduction is good
                + w_eng  * adherence_norm
```

For each StepState S:

```text
StepScore(S) = w_local * last_outcome_score
              + w_coh_step * coherence_effect
              + w_rv_step  * (-rv_effect)
              - w_burden   * user_burden_score
```

Weights start conservative and can be adjusted per protocol.

### 7.2 Adaptation rules (heuristics + bandits)

We combine **rule‑based thresholds** with **contextual bandits** from CR‑007:

1. **Advancement decisions** (module level):

   - If ModuleScore(M) exceeds `advance_threshold` *and* minimum number of sessions/steps done → suggest **advance** to next required module.  
   - If ModuleScore(M) is low or negative but adherence is good → suggest **repeat** or insert extra step(s).  
   - If ModuleScore(M) is strongly positive but coherence is dropping → suggest **slower pace** (avoid overshooting).

2. **Emphasis decisions** (step level):

   - For each module, define a discrete set of **step bundles** (e.g., “more exposure, less journaling”, “more journaling, fewer exposures”).  
   - Use a **contextual bandit** (like LinearUCB from CR‑007) to choose which bundle to prioritize in next block, context = participant features + ModuleState features.

3. **Branching decisions**:

   - For optional modules, treat them as arms in a **high‑level bandit**, but:  
     - only between low‑risk options,  
     - only after clinician approval of available branches.

PPE **never** changes protocol structure outside pre‑declared branchable/optional parts.

### 7.3 Meta‑policy integration

We treat PPE policies as a special MetaPolicy family:

- `MetaPolicy: "ProtocolPersonalization_<protocol_name>"` with versions and trust scores (CR‑008).  
- Each adaptation decision (advance/repeat/emphasize) is logged as a **PolicyEpisode** with reward computed from subsequent outcomes (e.g., symptom change vs coherence change).  [oai_citation:11‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
- MetaPolicyEngine decides:
  - whether to apply current personalization logic,  
  - or fall back to **static template** when trust is low.

---

## 8. Clinician & participant control

### 8.1 Clinician console changes

For each ProtocolInstance:

- Show **suggested adaptations**:

  - “Advance from Module 2 → 3 (reason: symptom improvement + RV Potency reduction).”  
  - “Repeat Module 1 exercises; exposure dose seems insufficient.”  
  - “Shift emphasis to journaling steps; exposures causing high arousal with low coherence.”

- Clinician can:

  - Accept suggestion (logged),  
  - Modify (e.g., advance but keep one step),  
  - Reject with reason.

These decisions feed back into PPE’s learning as “reward” / override signals (CR‑007/008).

### 8.2 Participant cockpit changes

Participant sees:

- Clear, simple description of **current protocol phase** and upcoming tasks.  
- Ability to **flag overload** or “too much repetition”, which increases `user_burden_score` and encourages PPE to reduce intensity.  
- No mention of “bandits” or technical terms – just “Your plan has been adjusted with your therapist.”

---

## 9. KMP app integration

The KMP app already consumes **task definitions** (MobileTrialConfig) from InterventionPlans (CR‑102/107). CR‑108 adds:

- A “weekly plan” endpoint:

  - `/mobile/protocol/{instance_id}/plan?week=N` → list of trial configs + step metadata.  

- PPE regenerates this plan after each adaptation step; mobile app pulls and presents:

  - exposures, journaling, decision tasks, sleep logging, etc.,  
  labeled by protocol and module.

Offline behavior stays the same: tasks run offline; events are queued and replayed when online (CR‑102).

---

## 10. Safety & ethics

To align with the paper’s cautious, falsifiable approach:  [oai_citation:12‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

- **Bounded adaptation**:
  - No new content, no changes to risk tier; only pacing and emphasis.  
  - High‑risk modules (e.g., intense exposures) have hard minimum/maximum rates set by clinician.  

- **Human veto**:
  - No adaptation is applied without clinician review for clinical protocols (can be more automatic for low‑stakes coaching protocols if explicitly allowed).  

- **Documentation & audit**:
  - Each adaptation includes a short machine‑generated explanation referencing ModuleScore components and MPG/RV changes (R(x) for the adaptation rule).  [oai_citation:13‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

- **Experimental status**:
  - All personalization features flagged as experimental in the UI and docs; outcomes should be evaluated in research before any serious clinical deployment.

---

## 11. Implementation steps

1. **Schema**  
   - Add `:ProtocolInstance`, `:ModuleState`, `:StepState`; link them to `:ClinicalProtocol`, `:ProtocolModule`, `:ProtocolStep`, `:InterventionPlan`, `:OutcomeMeasure`, `:Segment`.  

2. **Aggregation jobs**  
   - Implement periodic jobs that compute ModuleScore and StepScore from outcome measures + MPG/RV + coherence data.  

3. **PPE service**  
   - Implement a `personalization_service` that:
     - reads protocol state & scores,  
     - generates adaptation suggestions,  
     - writes decisions to Neo4j as `PolicyEpisode`s,  
     - updates ModuleState.personalized_weight and StepState statuses accordingly.  

4. **Meta‑policy hook**  
   - Wrap PPE decisions through `MetaPolicyEngine` (CR‑008) so you can control when personalization is active and track its trustworthiness.  

5. **Console & KMP UI**  
   - Add views for suggested adaptations & clinician approvals.  
   - Extend mobile plan retrieval to reflect updated tasks.

6. **Pilot**  
   - Run small pilots on each protocol (A/B/C) with personalization disabled vs enabled (shadow mode first), then under clinician supervision.  
   - Evaluate whether personalization improves adherence, coherence, symptom trends without safety issues.

---

## 12. Acceptance criteria

CR‑108 is complete when:

1. **Protocol instances are stateful**  
   - Each active protocol for a participant has `:ProtocolInstance` with `:ModuleState` and `:StepState` nodes and regularly updated scores.

2. **PPE generates reasonable suggestions**  
   - For at least one protocol, the engine proposes module advancement/repetition and step emphasis changes based on real data.  

3. **Clinician‑mediated adaptation**  
   - Clinicians can review, accept, modify, or reject suggestions from the console, with all decisions logged.  

4. **KMP app reflects personalization**  
   - Participants see task schedules that update according to accepted adaptations (e.g., more of step type X, fewer of type Y, module changes).  

5. **Safety & governance**  
   - MetaPolicy integration ensures personalization can be enabled/disabled per protocol and per participant, with trust scores.  
   - No high‑risk behavior occurs without clinician override; adaptations are auditable and reversible.  

6. **Empirical check (pilot)**  
   - For at least one protocol, you can run a small comparison (personalized vs static template) and observe:
     - no degradation of outcomes,  
     - signs of improved engagement or coherence,  
     - interpretable changes in RV Potency and MPG structure over time.  [oai_citation:14‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

If you want to go *even further* after CR‑108, a natural CR‑109 would focus on **population‑level meta‑learning**: learning cross‑participant patterns about which personalization strategies work for whom (based on MPG structure, RV profiles, and coherence signatures), while still keeping all recommendations routed through clinicians and governance layers.
