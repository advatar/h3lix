**Change Request: CR‑101 – Real‑Human Streaming Integration & Kotlin Multiplatform Edge App**

---

## 1. Objective

Connect **real humans and real‑world data streams** to the H3LIX / LAIZA stack by:

1. Introducing a **unified event model + streaming backbone** for all human‑related data (somatic, text, audio, video, app events).  [oai_citation:0‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
2. Implementing a **Kotlin Multiplatform (KMP)** mobile app as the primary edge node for wearables, phone sensors, self‑report, and interventions.  
3. Building ingest & processing services that map those streams into the **Somatic, Symbolic, and Noetic layers** and update the **Mirrored Profile Graph (MPG)** and `SegmentState` objects defined in earlier CRs.  [oai_citation:1‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

This CR operationalizes the LAIZA requirement of “a vast stream of input data encompassing all available data related to the user” and time‑locked Somatic–Symbolic–Noetic processing.  [oai_citation:2‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 2. Scope

### In scope (v1)

- **Unified event envelope** (JSON / Protobuf) for all incoming human data.  
- **KMP mobile app** (Android + iOS) that:
  - connects to wearables & phone sensors,
  - collects in‑app self‑report & tasks,
  - streams events securely to backend.
- Backend services:
  - **Ingest Gateway** (Python + FastAPI) to receive events from KMP and cloud connectors.
  - **Somatic Processor**: converts low‑level samples → features → ŝ(t) & summaries.  [oai_citation:3‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
  - **Symbolic Processor**: parses text/speech events → MPG nodes/edges + Evidence.  [oai_citation:4‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
  - **Noetic Processor**: computes coherence metrics from multi‑stream history.  [oai_citation:5‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
- Minimal connectors for:
  - Wearables via OS health APIs.
  - One email / chat provider (e.g., Gmail, Slack) as Symbolic demo.
- Neo4j mapping:
  - Stream events → `:Evidence`, `:SegmentState`, `:Trial`, `:Participant`.

### Out of scope (v1)

- Full coverage of every possible data source (we define pluggable pattern + 1–2 concrete sources).  
- Full production‑hardening / multi‑region infra.  
- On‑device ML beyond basic feature extraction.

---

## 3. Overall architecture

For each **Participant**:

- KMP app + selected cloud connectors emit **time‑stamped events** into an **Ingest Gateway**.  
- Ingest Gateway publishes events to a **streaming bus** (Kafka/Pulsar/RabbitMQ; or a simpler async queue in v1).  
- Dedicated processors consume by `stream_type`:
  - Somatic → feature extraction, state estimation, anticipatory markers.  [oai_citation:6‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
  - Symbolic → parsing, belief updates, MPG nodes/edges.  [oai_citation:7‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
  - Noetic → coherence matrices, entropy‑change, coherence spectra.  [oai_citation:8‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
- Mirror Core (from earlier CRs) ties this into the SORK‑N loop and writes to **Neo4j MPG**.  [oai_citation:9‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 4. Unified event model

### 4.1 Logical schema

Every inbound item is normalized to an **Event Envelope**:

```json
{
  "event_id": "uuid",
  "participant_id": "P123",
  "source": "android_ppg" | "apple_health" | "gmail" | "slack" | "android_mic" | "zoom_audio" | "...",
  "stream_type": "somatic" | "text" | "audio" | "video" | "task" | "meta",
  "timestamp_utc": "2025-11-26T12:34:56.789Z",
  "device_clock": 1234567890,
  "session_id": "S456",
  "payload": { "... source-specific ..." },
  "quality": {
    "sampling_rate_hz": 25,
    "signal_to_noise": 0.82
  }
}
```

This is the “LAIZA event” that all pipelines consume; it embodies the **time‑locking to a master clock with event markers** described for Somatic and Symbolic layers.  [oai_citation:10‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

### 4.2 Shared models

Create **language‑agnostic models**:

- Kotlin `@Serializable data class EventEnvelope` (in KMP `shared` module).  
- Python `pydantic.BaseModel` for backend services.

These must stay in sync; they form the contract for all data sources.

---

## 5. Kotlin Multiplatform mobile app

The KMP app is the **primary edge node** for human interaction.

### 5.1 Module layout

- `app/shared` (KMP common):
  - EventEnvelope & payload models.
  - Crypto (key management, encryption).
  - Network client (Ktor) with WebSocket + HTTP fallback.
  - Local store (SQLDelight) for offline queues.
  - Minimal somatic feature extraction (windowing, HRV stats).
  - Config sync (scopes enabled, sampling rates, upload intervals).

- `app/androidApp`:
  - Integrations:
    - Google Health Connect / vendor SDKs for HR/HRV, steps, sleep.
    - Phone sensors (accelerometer, gyroscope).
    - BLE connections to supported wearables (e.g. ECG/EDA belts).
  - UI:
    - consent flow & scope toggles,
    - trial UIs (for MPG‑Intuition experiments),
    - self‑report & awareness check screens (CR‑005),
    - intervention prompts (CR‑007).

- `app/iosApp`:
  - Similar to Android, using HealthKit + CoreMotion + BLE.

### 5.2 Shared event pipeline (KMP common)

Pseudo‑code (common `shared` module):

```kotlin
@Serializable
data class EventEnvelope(
    val eventId: String,
    val participantId: String,
    val source: String,
    val streamType: String,
    val timestampUtc: String,
    val deviceClock: Long,
    val sessionId: String? = null,
    val payload: JsonElement,
    val quality: Quality? = null
)

object EventStreamer {
    suspend fun send(events: List<EventEnvelope>) {
        // batch + encrypt + POST/WS to Ingest Gateway
    }
}
```

Platform‑specific code just **fills this envelope** and hands it to `EventStreamer`.

### 5.3 Example: Android HR stream

Android‑specific (simplified):

```kotlin
class HeartRateCollector(
    private val healthClient: HealthConnectClient,
    private val participantId: String
) {
    suspend fun pollAndSend() {
        val samples = readHeartRateSamples(healthClient) // platform API
        val events = samples.map { sample ->
            EventEnvelope(
                eventId = UUID.randomUUID().toString(),
                participantId = participantId,
                source = "android_ppg",
                streamType = "somatic",
                timestampUtc = sample.timeUtc,
                deviceClock = SystemClock.elapsedRealtime(),
                payload = buildHeartPayload(sample),
                quality = Quality(samplingRateHz = 1.0, signalToNoise = null)
            )
        }
        EventStreamer.send(events)
    }
}
```

---

## 6. Backend ingest & streaming

### 6.1 Ingest Gateway (Python + FastAPI)

A service `ingest_gateway.py`:

- `POST /v1/events/batch` – accepts list of EventEnvelope JSON.  
- Validates with Pydantic.  
- Publishes each event to a **message bus** (e.g., Kafka topic `events.<stream_type>`).

Minimal implementation can use an internal async queue; later swap in Kafka/Pulsar.

### 6.2 Topics / queues

At minimum:

- `events.somatic`  
- `events.text`  
- `events.audio`  
- `events.video`  
- `events.task`  

Consumer services subscribe by type and participant.

---

## 7. Somatic Processor service

Implements the Somatic layer pipeline described in Sec. 3.1: signals → features z(t) → Bayesian filter → ŝ(t)+ε(t) → event‑locked summaries.  [oai_citation:11‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

Responsibilities:

1. Consume `events.somatic`.  
2. Maintain per‑participant buffers for short windows (e.g., 30 s sliding).  
3. Compute features:
   - HRV metrics, GSR peaks, motion energy, etc.  
4. Run lightweight Kalman‑style filter to estimate ŝ(t).  [oai_citation:12‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
5. Emit **SomaticSummary** events:

   ```json
   {
     "participant_id": "P123",
     "timestamp_utc": "...",
     "state_vector": [...],
     "covariance_diag": [...],
     "innovation": [...],
     "markers": ["pre_decision_ramp", "arousal_spike"]
   }
   ```

6. Write to Neo4j:
   - Create `:Evidence {source_type:"SOMATIC"}` linked to:
     - `(:Trial)` when in an experiment, **and/or**
     - relevant `:Segment` nodes (stress, sleep, habits).  [oai_citation:13‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
   - Update or create `:SegmentState` snapshots with somatic fields (`somatic_arousal`, etc.), following CR‑003.

---

## 8. Symbolic Processor service

Implements the Symbolic layer (LAIZA) for **textual/linguistic/behavioral streams**.  [oai_citation:14‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

Responsibilities:

1. Consume `events.text` (from:
   - in‑app journaling,
   - email/chat connectors,
   - ASR transcripts from audio/video).
2. Run NLP/LLM pipeline to extract:
   - entities, events, relations, sentiments, intents.  [oai_citation:15‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
3. Map them into MPG:

   - New `:MPGNode` for traits, events, cues, etc.  
   - Edges with types like `CAUSES`, `TRIGGERS`, `CONTRADICTS`, etc.  [oai_citation:16‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
   - Evidence items (Definition 1’s `E(x)` and reasoning `R(x)`).  [oai_citation:17‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

4. Trigger periodic **Lift** from level‑0 to level‑1 (`:Segment`) as in Definitions 2–4; this is how continuous life data grows the MPG hierarchy.  [oai_citation:18‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 9. Noetic Processor service

Implements the Noetic layer: coherence across Somatic–Symbolic–outcome streams.  [oai_citation:19‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

Responsibilities:

1. Consume:
   - SomaticSummary events,
   - Symbolic snapshots/belief changes,
   - `:Trial` / outcome events.  
2. Compute, for sliding windows:
   - correlation matrices (somatic vs belief vs performance),  
   - entropy‑change metrics,  
   - coherence spectra (time/frequency alignment).  [oai_citation:20‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
3. Output **coherence scores** `C(t)` and write to:
   - `:SegmentState.coherence`,  
   - `:Trial.coherence`,  
   - group‑level structures if CR‑006 is active.

These outputs directly feed back into Mirror Core’s N→S′ adjustments and into policy learning (CR‑007).  [oai_citation:21‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 10. External connectors (email, messaging, etc.)

For each extra source, implement a **connector microservice** that:

1. Authenticates with provider (OAuth).  
2. Polls or subscribes to new items.  
3. Transforms provider payload → EventEnvelope with `stream_type="text"` or `"meta"`.  
4. Sends events to Ingest Gateway.

Example: `gmail_connector.py`:

- Maps Gmail message metadata + body (or summary) into events.  
- Attaches `participant_id` via secure lookup of email → Participant.

---

## 11. Neo4j integration extensions

Extend schema (from CR‑005) with:

- `:DataSource` nodes (optional) to track which sources are active.  
- `(:Participant)-[:USES_SOURCE]->(:DataSource)` with scopes & settings.  
- `:Evidence` and `:SegmentState` populated from streaming processors.

Ensure that each **event‑derived structural change** has:

- Evidence (`E(x)`),  
- Confidence (`Conf(x)` from Evidence),  
- Importance (`Imp(x)` from importance model),  
- Reasoning (`R(x)`), as required by the Layer‑Type Graph definition and MPG dynamics.  [oai_citation:22‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 12. Security & privacy constraints

- All KMP app traffic: TLS + application‑level encryption (per‑participant key).  
- Local data on device: encrypted store, explicit retention limits.  
- Backend:
  - Pseudonymous `participant_id`; any link to real identity is stored separately or avoided.  
  - Per‑scope consent recorded in Neo4j and enforced by Ingest Gateway (reject events for disabled scopes).  
- No raw audio/video stored in Neo4j; store only URIs to secure object storage + derived symbolic/somatic features.

This follows the paper’s guidance on digital phenotyping safety and privacy.  [oai_citation:23‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 13. Implementation steps (minimal viable CR‑101)

1. **Define event models**  
   - Kotlin + Python definitions for EventEnvelope and basic payload types.  
   - Shared JSON schema.

2. **Implement KMP shared module**  
   - Networking, storage, encryption, EventStreamer.  
   - Minimal HR/step feature extraction.

3. **Android app skeleton**  
   - Consent + settings UI.  
   - Health Connect integration for HR/steps.  
   - Periodic polling & streaming to Ingest Gateway.

4. **Backend ingest & queues**  
   - FastAPI Ingest Gateway with batch endpoint.  
   - Simple in‑memory or Redis queue routing by `stream_type`.

5. **Somatic Processor v1**  
   - Consume HR events; compute HRV features; produce SomaticSummary; store as `:Evidence` in Neo4j.

6. **Symbolic Processor v1**  
   - Handle only in‑app journaling text; parse into simple `:MPGNode` (e.g., mood, activity) + edges.

7. **Noetic Processor v1**  
   - Cheap coherence metric: correlation between HRV & “mood” ratings across windows; write `coherence` to `:Trial`.

8. **Wire into existing Mirror Core / MPG stack**  
   - Updates to `:SegmentState`, `:Trial`, `:Evidence` from real streams instead of synthetic data.

9. **Pilot test with internal users**  
   - Run for a few days; inspect Neo4j MPG growth and coherence traces.

---

## 14. Acceptance criteria

CR‑101 is complete when:

1. **End‑to‑end streaming works**  
   - A KMP Android app can collect HR + simple self‑report, and those events:
     - hit the Ingest Gateway,  
     - flow through Somatic + Symbolic processors,  
     - result in `:Evidence` / `:SegmentState` objects in Neo4j.

2. **Time‑locking & synchronization**  
   - Somatic summaries and symbolic events for the same real‑world episode align within expected timing error, satisfying LAIZA’s time‑locking requirement.  [oai_citation:24‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

3. **MPG updates from real data**  
   - New `:MPGNode` and `:Segment` structures appear over time for a participant, created via Lift from the streaming traces (not just synthetic scripts).  [oai_citation:25‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

4. **Noetic coherence from real streams**  
   - Coherence scores are computed for real episodes and written into `:SegmentState` / `:Trial`, enabling later use by MUFS and policy logic.  [oai_citation:26‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

5. **Privacy & safety basics**  
   - Per‑scope consent is stored and enforced.  
   - Data in transit and at rest (on device + backend) is encrypted.  
   - No PII is stored in Neo4j beyond pseudonymous IDs.

---

If you’d like a follow‑up, **CR‑102** could focus on *expanding the KMP app* (more sensors, richer tasks, offline experiments), and **CR‑103** on *adding full email/chat/audio/video connectors* and mapping them into richer MPG structures and MUFS‑driven experimental protocols.
