**Change Request: CR‑005 – Human‑in‑the‑Loop LAIZA Integration & MPG‑Intuition Human Experiments**

---

## 1. Objective

Extend CR‑001–CR‑004 with **human participants**, so you can actually run the full experimental program in Section 6:

1. Run **matched blocks** of trials with human participants and the system in parallel under **Full vs Restricted awareness** (IU & PU).  [oai_citation:0‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
2. Collect **somatic**, **behavioral**, and **introspective (self‑report)** data per trial, time‑locked to the LAIZA protocol (Somatic–Symbolic–Noetic loop, SORK‑N).  [oai_citation:1‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
3. Use CR‑004’s **MUFS & MPG‑Intuition** machinery to:
   - Mark human trials where the *system* finds a MUFS, and  
   - Correlate MUFS & coherence with **human flips**, **accuracy**, **calibration**, and **self‑reported intuition**.  [oai_citation:2‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

This implements the “Human decisions (external confirmation)” and “Intuition self‑report linkage” parts of the experimental strategy.  [oai_citation:3‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 2. Scope

### In scope

- New **data model** for:
  - `:Participant`, `:Session`, `:Trial` (extended), `:SelfReport`, `:AwarenessCheck`.
- Integration of existing **Somatic Layer** pipeline (sensors → ŝ(t)) with human trials.  [oai_citation:4‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
- A Python **Experiment Runner** that:
  - Presents stimuli & masks.
  - Logs human responses & timings.
  - Triggers Mirror Core for **system decisions (full/restricted)** for the same trial.
  - Stores MUFS and MPG‑Intuition flags from CR‑004.
- Extensions to the FastAPI service (from CR‑002) to fetch participant/session/trial data for dashboards.

### Out of scope

- Full front‑end UI/UX (we define REST endpoints & data, not full React apps).
- Actual psychophysical toolkit implementation (PsychoPy, jsPsych, etc.), though the CR assumes such a tool calls the Experiment Runner API.
- IRB / ethics approval (but we’ll flag it as required; the paper explicitly notes digital phenotyping risks & the need for safeguards).  [oai_citation:5‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 3. High‑level architecture

You already have:

- **MPG & RV stack** (CR‑001–3): `:MPGNode`, `:Segment`, `:SegmentState`, Potency, RV flags, Noetic coherence hooks.  [oai_citation:6‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
- **MUFS & MPG‑Intuition** pipeline (CR‑004) operating on **system‑only** trials.  [oai_citation:7‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

CR‑005 adds:

- **Human side:**

  - Participants → Sessions → Trials  
  - Per‑trial: stimuli, awareness condition, human choice, RT, correctness, introspection, awareness checks, somatic summary.

- **Parallel system side:**

  - System decision (full & restricted).
  - MUFS results, MPG‑Intuition flags (from CR‑004).
  - Link to Potency & coherence via `:SegmentState`.

Everything is time‑locked by LAIZA’s **master clock** so Somatic, Symbolic, and Noetic traces can be aligned, as in Sec. 3.1–3.3.  [oai_citation:8‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 4. Neo4j schema: people, sessions, trials & self‑report

### 4.1 Participants and sessions

New labels:

- `:Participant`
- `:Session`
- `:SelfReport`
- `:AwarenessCheck`

Constraints:

```cypher
CREATE CONSTRAINT participant_id IF NOT EXISTS
FOR (p:Participant) REQUIRE p.id IS UNIQUE;

CREATE CONSTRAINT session_id IF NOT EXISTS
FOR (s:Session) REQUIRE s.id IS UNIQUE;

CREATE CONSTRAINT trial_id IF NOT EXISTS
FOR (t:Trial) REQUIRE t.id IS UNIQUE;

CREATE CONSTRAINT selfreport_id IF NOT EXISTS
FOR (r:SelfReport) REQUIRE r.id IS UNIQUE;

CREATE CONSTRAINT awarenesscheck_id IF NOT EXISTS
FOR (a:AwarenessCheck) REQUIRE a.id IS UNIQUE;
```

Basic structure:

```cypher
// Participant profile (non‑identifying pseudonym by default)
CREATE (p:Participant {
  id: $uuid,
  alias: $alias,             // pseudonym / code
  age_band: $age_band,       // e.g. "25–34"
  gender: $gender,           // optional
  created_at: datetime()
});

// Session
MATCH (p:Participant {id: $pid})
CREATE (s:Session {
  id: $sid,
  started_at: datetime(),
  protocol_version: "H3LIX_LAIZA_v1",
  notes: $notes
})
CREATE (p)-[:HAS_SESSION]->(s);
```

### 4.2 Trials (extended for human + system)

Extend your existing `:Trial` design (from CR‑004) with human fields:

```cypher
MATCH (s:Session {id: $sid})
CREATE (t:Trial {
  id: $tid,
  index: $idx,                    // trial number within session
  stimulus_id: $stim_id,          // link to task DB
  awareness_condition: $ac,       // "FULL" | "IU" | "PU" | "MIX"
  mask_type: $mask_type,          // e.g. "BRIEF_MASK", "PERIPHERAL", "NONE"

  // HUMAN SIDE
  human_choice: $h_choice,        // e.g. int or string
  human_rt_ms: $h_rt,
  human_correct: $h_correct,
  human_confidence: $h_conf,      // 0..1
  human_intuition_rating: $h_int, // 0..1; “felt intuitive”
  human_notes: $h_notes,

  // SYSTEM SIDE (mirror core)
  sys_choice_full: $sys_full,
  sys_choice_restricted: $sys_rest,
  sys_rt_ms_full: $sys_rt_full,
  sys_rt_ms_restricted: $sys_rt_rest,
  sys_correct_full: $sys_corr_full,
  sys_correct_restricted: $sys_corr_rest,

  // MUFS / intuition (from CR‑004)
  has_mufs: false,
  mufs_size: 0,
  mufs_type: "NONE",
  mpg_intuitive: false,

  created_at: datetime()
})
CREATE (s)-[:HAS_TRIAL]->(t);
```

### 4.3 Self‑reports and awareness checks

Two kinds of per‑trial human reports, per Sec. 6 (“Human decisions” & “Intuition self‑report linkage”):  [oai_citation:9‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

```cypher
// Self-report (intuition + confidence + brief narrative)
MATCH (t:Trial {id: $tid})
CREATE (r:SelfReport {
  id: $rid,
  trial_id: $tid,
  intuition_rating: $intuition,   // 0..1 slider
  confidence_rating: $confidence, // 0..1 slider
  felt_state: $felt_state,        // e.g. "calm", "rushed", etc.
  comment: $comment,
  created_at: datetime()
})
CREATE (t)-[:HAS_SELF_REPORT]->(r);

// Awareness check (for IU)
MATCH (t:Trial {id: $tid})
CREATE (a:AwarenessCheck {
  id: $aid,
  trial_id: $tid,
  question: $q,                   // e.g. "Did you see a flash on the left?"
  response: $resp,                // e.g. "YES" / "NO"
  forced_choice_accuracy: $acc,   // objective awareness test, 0..1
  created_at: datetime()
})
CREATE (t)-[:HAS_AWARENESS_CHECK]->(a);
```

---

## 5. Somatic layer integration for human trials

Per Sec. 3.1, the Somatic layer: sensors → features → state estimate ŝ(t) + innovation ε(t), with anticipatory markers around decisions.  [oai_citation:10‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

In CR‑005 we **bind this to participants**:

### 5.1 Data paths

- Wearable / biosensors stream raw data to your existing **Somatic service** (CR‑001):
  - Channels: HR/HRV, EDA, respiration, pupil, micro‑motion, etc.
- Somatic service:
  - Preprocesses & extracts features.
  - Maintains sliding windows & Bayesian filter → ŝ(t).
  - Emits **event‑locked summaries** around `stimulus_onset`, `decision_time`.

### 5.2 Minimal additional schema

We don’t push raw sensor streams into Neo4j; we store **summaries** as evidence linked to trials and segments:

```cypher
MATCH (t:Trial {id: $tid})
CREATE (e:Evidence {
  id: $eid,
  description: "Somatic pre-decision arousal summary",
  source_type: "SOMATIC",
  pointer: $tsdb_key,      // link to TS DB / file
  snippet: $summary_text,
  c: $c, q: $q, u: 1.0, t: $t_factor,
  created_at: datetime()
})
CREATE (t)-[:HAS_EVIDENCE]->(e);
```

You can also attach somatic evidence directly to `:Segment` nodes when you detect stable somatic patterns associated with those segments, consistent with `Evidence` in Definition 1 and the dynamics section.  [oai_citation:11‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 6. Experiment Runner: humans + system in parallel

Create `experiments/human_runner.py` that coordinates:

- Trial presentation (triggered externally by a psychophysics toolkit).
- Human response logging.
- System decisions (full & restricted).
- MUFS search and MPG‑Intuition flags (calling CR‑004).

### 6.1 Core runner loop (sketch)

```python
# experiments/human_runner.py
from dataclasses import dataclass
from typing import Dict, Any
import time
import uuid

from neo4j import GraphDatabase
from .mirror_core import MirrorCore   # from earlier CRs
from .mufs import mufs_search_trial   # wrapper around CR-004
from .noetic import get_coherence     # optional, from CR-003


@dataclass
class HumanTrialInput:
    participant_id: str
    session_id: str
    stimulus_id: str
    awareness_condition: str   # "FULL" | "IU" | "PU" | "MIX"
    mask_type: str             # e.g. "BRIEF_MASK"
    task_metadata: Dict[str, Any]


class HumanExperimentRunner:
    def __init__(self, neo4j_uri, neo4j_user, neo4j_password, mirror_core: MirrorCore):
        self.driver = GraphDatabase.driver(neo4j_uri, auth=(neo4j_user, neo4j_password))
        self.mirror_core = mirror_core

    # called by front-end / psychophysics script at trial onset
    def run_trial(self, htrial: HumanTrialInput) -> str:
        tid = str(uuid.uuid4())
        t_start = time.time()

        # 1) Present stimulus & mask externally; we just mark timestamps
        # (front-end sends human response back to us)
        # ... front-end code not shown ...

        # 2) Wait for human response
        human_choice, human_rt_ms, human_correct = self.collect_human_response()

        # 3) Ask for self-report & awareness
        h_int, h_conf, comment = self.collect_self_report()
        awareness_resp, awareness_acc = self.collect_awareness_check()

        # 4) Record Trial node
        self._create_trial_node(
            tid, htrial, human_choice, human_rt_ms, human_correct, h_int, h_conf
        )
        self._create_self_report_and_awareness(
            tid, h_int, h_conf, comment, awareness_resp, awareness_acc
        )

        # 5) Run system in parallel on same stimulus
        sys_full = self.mirror_core.decide_full(htrial.stimulus_id, htrial.task_metadata)
        sys_rest = self.mirror_core.decide_restricted(
            htrial.stimulus_id,
            htrial.task_metadata,
            htrial.awareness_condition,
            htrial.mask_type,
        )

        # 6) Update Trial with system decisions
        self._update_trial_with_system(
            tid, sys_full=sys_full, sys_rest=sys_rest
        )

        # 7) Trigger MUFS search (CR-004) + Potency/Noetic hooks (CR-003)
        mufs_result = mufs_search_trial(tid)   # reads Trial + MPG, writes MUFS, mpg_intuitive, etc.
        coherence = get_coherence(tid)        # optional

        # Optionally: write coherence into SegmentState or Trial
        # ...

        return tid

    # > Implement _create_trial_node, _create_self_report_and_awareness,
    #   _update_trial_with_system using Neo4j queries from earlier sections.
```

The **front‑end** (e.g., PsychoPy / jsPsych) will:

- Call `POST /api/trial/start` with `HumanTrialInput`.
- Present stimulus + mask.
- Send back human response & RT to `POST /api/trial/{id}/response`.
- Send self‑report & awareness responses.

The runner ties everything into Neo4j + Mirror Core.

---

## 7. API extensions (FastAPI)

Add to your existing FastAPI service:

```python
# api/human_api.py
from fastapi import APIRouter
from pydantic import BaseModel

router = APIRouter(prefix="/human", tags=["human"])


class NewParticipant(BaseModel):
    alias: str
    age_band: str | None = None
    gender: str | None = None


@router.post("/participant")
def create_participant(p: NewParticipant):
    # Neo4j insert, return participant_id
    ...


class NewSession(BaseModel):
    participant_id: str
    notes: str | None = None


@router.post("/session")
def create_session(s: NewSession):
    # Neo4j insert, return session_id
    ...


class TrialStart(BaseModel):
    participant_id: str
    session_id: str
    stimulus_id: str
    awareness_condition: str
    mask_type: str
    task_metadata: dict = {}


@router.post("/trial/start")
def start_trial(ts: TrialStart):
    # call HumanExperimentRunner.run_trial(...)
    ...
```

You can also add:

- `GET /trial/{id}` – returns human + system + MUFS info.  
- `GET /participant/{id}/summary` – for analysis dashboards.

---

## 8. Analysis notebooks (human ↔ system ↔ MUFS ↔ coherence)

Create `analysis/human_mpg_intuition.ipynb` to:

1. **MUFS incidence by condition**  
   - `P(has_mufs | awareness_condition)`; verify restricted > full.  [oai_citation:12‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

2. **Flip rates**  
   - Human: flips in choice between full vs restricted blocks.  
   - System: same, via `sys_choice_full` vs `sys_choice_restricted`.  
   - Overlap with `Trial.mpg_intuitive = true`.

3. **Self‑reported intuition linkage**  
   - Compare trials with `human_intuition_rating` high vs low:
     - Noetic coherence (from `SegmentState.coherence`).  [oai_citation:13‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
     - MUFS presence & size.  
     - Accuracy / calibration (Brier score using `human_confidence` and correctness).

4. **Plots**  
   - Histograms or violin plots of coherence vs intuition rating.  
   - Scatter of Potency vs MUFS size vs intuitive flag.

This matches Section 6’s prediction: self‑labeled intuitive trials under *restricted* awareness show higher coherence, more MUFS, and better calibration/accuracy.  [oai_citation:14‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 9. Ethics & privacy

The paper explicitly flags **digital phenotyping** and safety considerations, as well as privacy and governance for MPG edits.  [oai_citation:15‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

Implementation requirements:

- Use pseudonymous `Participant.id`; store real identities (if any) in a separate, secure system, or not at all.
- Explicit consent flow explaining:
  - Multimodal data (physiology, text, behavior) collected.
  - Storage & retention policies.
  - Right to withdraw data.
- Role‑based access:
  - Only certain roles can view full `:Participant` graphs or detailed somatic traces.
- Logging & provenance:
  - All changes to MPG structures, MUFS results, and meta‑policies must be auditable (already aligned with the “governance and impact accounting” role of RVs).  [oai_citation:16‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

---

## 10. How to run CR‑005 end‑to‑end

1. Ensure CR‑001–CR‑004 are running (MPG, RV, Potency, MUFS).  [oai_citation:17‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  
2. Apply Neo4j schema updates for `:Participant`, `:Session`, `:Trial` extensions, `:SelfReport`, `:AwarenessCheck`, `:MUFS`.  
3. Implement `HumanExperimentRunner` and hook it into your FastAPI API.  
4. Integrate with a psychophysics toolkit (or a simple web UI) that:
   - Calls `/human/participant`, `/human/session`, `/human/trial/start`.  
   - Presents stimuli & masks.  
   - Sends responses & self‑reports back.  
5. Run small pilot sessions (N ≈ 3–5 participants) to verify:
   - Synchronization of somatic, behavioral, and system traces.
   - MUFS search works on real trials.
   - Analytics notebook produces sensible MUFS incidence, flip rates, and coherence correlations.

---

## 11. Acceptance criteria

CR‑005 is complete when:

1. **Human data model & APIs**
   - `:Participant`, `:Session`, `:Trial`, `:SelfReport`, `:AwarenessCheck` exist and are linked as specified.
   - FastAPI provides endpoints to create participants, sessions, and start trials.

2. **Somatic & LAIZA integration**
   - For each trial, Somatic summaries (`ŝ(t)`, anticipatory markers) can be linked via Evidence to `:Trial` and relevant `:Segment` nodes, as per Sec. 3.1.  [oai_citation:18‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

3. **Parallel human/system runs**
   - For every restricted human trial, there is:
     - human decision + RT + correctness,
     - system decisions (full & restricted),
     - MUFS data from CR‑004,
     - optional coherence & Potency from CR‑003.

4. **MPG‑Intuition labels**
   - `Trial.mpg_intuitive` is set according to MUFS existence for each restricted trial.
   - You can query MUFS incidence, human flips, and coherence exactly as described in Section 6 (“Human decisions” and “Intuition self‑report linkage”).  [oai_citation:19‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)  

5. **Analysis notebook**
   - `human_mpg_intuition.ipynb` runs end‑to‑end on pilot data and produces:
     - MUFS incidence by awareness condition.
     - Human/system flip rates relative to MUFS.
     - Plots tying self‑reported intuition to coherence, MUFS, and accuracy.

6. **Ethics & privacy**
   - Documented consent procedure and data‑handling policy exist.
   - Access controls around participant MPG data are in place.

---

If you’d like a **CR‑006**, a natural follow‑up would be **multi‑participant / collective MPG and coherence**, using multiple `:Participant` graphs, cross‑participant echoes, and group‑level Noetic coherence metrics—matching the paper’s hints about collective coherence and multi‑agent MPG echoes.  [oai_citation:20‡Symbiotic_human_AI_architecture.pdf](sediment://file_000000000db071f49f637b00e8081106)
